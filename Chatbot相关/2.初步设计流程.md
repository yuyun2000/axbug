
| 时间步 | 客户行为     | 大模型行为                                                                                                                                                                            |
| --- | -------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | 发送问题     | 记录会话上下文，进入多级处理流水线                                                                                                                                                                |
| 2   |          | 并行执行：  <br>1. 查询理解：分析问题类型、实体、意图；初筛模型（小参数无思维链模型）使用函数调用判断是否回复、回复的语种、是否调用知识库、产品型号等，通过函数的方式返回<br>2. 对话管理：结合历史上下文理解完整意图  <br>3. 知识检索：基于混合检索策略获取候选信息  <br>4. 缓存查询（待做）：检查是否存在相似历史问题<br> |
| 3   |          | 1. 基于问题类型选择处理模型和回答策略  <br>2. 基于知识可信度和多样性评分筛选知识  <br>3. 对知识进行聚合、消歧和排序  <br>4. 选择最适合的回答生成方式(直接回答/引导式/拒答)<br><br>                                                                   |
| 4   | 得到答复     |                                                                                                                                                                                  |
| 5   | 可能的反馈    | 收集反馈，赞或踩，踩的原因（虚假信息，没有帮助，有害信息，其他）                                                                                                                                                 |
| 6   | 继续提问或者退出 |                                                                                                                                                                                  |


# 反馈机制
保存一些对话记录进行持续改进
1、聊天界面的赞和踩，点赞的一般可以直接作为正向示例添加到知识库
2、上述第3步中知识库分数得分过低的情况，可能需要人为补充